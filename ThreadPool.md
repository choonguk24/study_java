## 线程池的应用及实现

### 为什么使用线程池
1. 线程在java中是一个对象，更是操作系统的资源，线程创建，销毁需要时间。如果创建时间 + 销毁时间 > 执行任务的时间就很合算。
2. java对象占用堆内存，线程过多，会消耗很多内存。
3. 操作系统需要频繁切换线程上下文，影响性能。  
线程池的推出，就是为了方便的控制线程数量。
### 线程池原理-概念
1. 线程池管理器
2. 工作线程
3. 任务接口
4. 任务队列： 用于存放没有处理的任务。提供一种缓冲机制。
### 线程池API-接口定义和实现类
- 接口
    - Executor
    - ExecutorService： 
    - ScheduledExecutorService
- 实现类
    - ThreadPoolExecutor： 标准线程池实现
    - ScheduledThreadPollExecutor： 扩展了定时功能

#### 线程池原理- 任务execute过程
1. 是否达到核心线程数量？ 没达到，创建一个工作线程来执行任务。
2. 工作队列是否已满？ 没满，则将新提交的任务存储在工作队列里。
3. 是否达到线程池最大数量？ 没达到，则创建一个新的工作线程来执行任务。
4. 最后，执行拒绝策略来处理这个任务。

![img](http://img.jeepxie.net/upload/e/c3/ec35bc86c60a2b64f70a7dc45c774921_thumb.png)

#### 线程数量
如何确定合适数量的线程？
- 计算型任务： cpu数量的1-2倍
- IO形任务： 相对计算型任务，需多一些线程，要根据具体的IO阻塞时长进行考量决定。也可考虑根据需要在一个最小数量和最大数量减自动增减线程数。
